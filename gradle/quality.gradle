allprojects {
    apply plugin: 'jacoco'
    apply plugin: 'info.solidsoft.pitest'
}

subprojects {
    apply plugin: 'com.github.ksoichiro.console.reporter'

    jacocoTestReport {
        reports {
            xml.enabled true
        }
        afterEvaluate {
            classDirectories = files(classDirectories.files.collect {
                fileTree(dir: it,
                    exclude: [
                        'com/ksoichiro/task/domain/Q*',
                    ])
            })
        }
    }
    check.dependsOn 'jacocoTestReport'

    pitest {
        targetClasses = ['com.ksoichiro.task.*']
    }
    //check.dependsOn 'pitest'

    consoleReporter {
        jacoco {
            coverageTaskName 'allProjectJacocoTestReport'
            reportFile project.file("${buildDir}/reports/jacoco/allProjectJacocoTestReport/allProjectJacocoTestReport.xml")
        }
    }
}
